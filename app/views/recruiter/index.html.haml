.row
  .span12
    %h3 Daftar calon peserta FIM 14
  .span1
    = link_to('Download', recruiter_index_path(:format => 'xls'), :class => 'btn btn-primary')
  .span1
    = link_to('Upload', recruiter_upload_path, :class => 'btn btn-primary')
  .span6
    -if @is_recruiter_coordinator
      -if params[:marked_by_id]
        =link_to("Lihat semua", recruiter_index_path, :class => 'btn')
      -else 
        =link_to("Lihat penugasan saya", recruiter_index_path(:marked_by_id => current_user.id), :class => 'btn')
  - cache('recruiter_progress_' + current_user.id.to_s, :expires_in => 10.minutes) do
    .span4
      %p
        Dinilai:
        %b= count_marked(current_user.id)
        | Sisa:
        %b= count_submitted(current_user.id)
        (Update per 10 menit)

.row{:style => 'margin-top: 20px'}
  .span12
    = form_tag update_marked_by_profile_candidates_path, :method => :put do
      - if @is_recruiter_coordinator
        - cache('recruiters_select', :expires_in => 1.hour) do
          = select("recruiter", "id", Role.includes(:users).find_by_name('recruiter').users.collect{|u| [ u.email, u.id]})
          - if params[:page]
            = hidden_field_tag("page", params[:page]) 
        %br
        = submit_tag("Assign checked candidates", :class => 'btn btn-primary')
        %br
        %br
      = render :partial => 'profile_candidates/index', :locals => {:profiles => @profiles, :full_column => true}

- cache('recruiters_statistics', :expires_in => 10.minutes) do
  .row{:style => 'margin-top: 20px'}
    .span9
      %h4 Statistik penilaian (Update per 10 menit)
      %table.table.table-condensed.table-striped
        %thead
          %tr
            %th Email
            %th Dinilai
            %th Sisa
            %th Min
            %th Max
            %th Avg Organi
            %th Avg Kepani
            %th Avg Wawasa
            %th Avg Dokume
            %th Avg Reliab
            %th Avg Willin
            %th Avg Total
        %tbody
          - Role.includes(:users).find_by_name('recruiter').users.each do |r|
            %tr
              -if @is_recruiter_coordinator
                %td
                  =link_to(r.email, recruiter_index_path(:marked_by_id => r.id))
              -else
                %td= r.email
              %td= count_marked(r.id)
              %td= count_submitted(r.id)
              %td= min_point(r.id)
              %td= max_point(r.id)
              %td= average_point(r.id, :organization_point)
              %td= average_point(r.id, :committee_point)
              %td= average_point(r.id, :personal_knowledge_point)
              %td= average_point(r.id, :document_completeness_point)
              %td= average_point(r.id, :reliability_point)
              %td= average_point(r.id, :willingness_point)
              %td= average_point(r.id)
          %tr
            %td
              %b Unassigned
            %td
            %td= count_unassigned
            %td
            %td
            %td
            %td
            %td
            %td
            %td
            %td
            %td
          %tr
            %td
              %b Global
            %td
              %b= count_marked(:all)
            %td
              %b= count_submitted(:all)
            %td
              %b= min_point(:all)
            %td
              %b= max_point(:all)
            %td
              %b= average_point(:all, :organization_point)
            %td
              %b= average_point(:all, :committee_point)
            %td
              %b= average_point(:all, :personal_knowledge_point)
            %td
              %b= average_point(:all, :document_completeness_point)
            %td
              %b= average_point(:all, :reliability_point)
            %td
              %b= average_point(:all, :willingness_point)
            %td
              %b= average_point(:all)
    .span3
      %h4 Provinsi (Update per 10 menit)
      %table.table.table-condensed.table-striped
        %thead
          %tr
            %th{:style => 'width:70%'} Provinsi
            %th Jumlah
        %tbody
          -@provinces_count.each do |province|
            %tr
              %td
                =link_to(province[0], recruiter_index_path(:province => province[0]))
              %td= province[1]